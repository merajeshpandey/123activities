<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity 1,2,3 Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f0f;
            position: absolute;
            animation: confetti-fall 3s linear;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Responsive container based on device screen size */
        .game-container {
            background: white;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            padding: 40px;
            position: relative;
            /* Default for 15" laptop (1366x768 or 1920x1080) */
            max-width: min(1200px, 85vw);
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Optimize for different screen sizes */
        @media screen and (min-width: 1280px) and (max-width: 1600px) {

            /* 15" laptop screens */
            .game-container {
                max-width: 1100px;
                font-size: 16px;
            }
        }

        @media screen and (min-width: 1601px) {

            /* Larger screens */
            .game-container {
                max-width: 1400px;
                font-size: 18px;
            }
        }

        @media screen and (max-width: 1279px) and (min-width: 768px) {

            /* Tablets and smaller laptops */
            .game-container {
                max-width: 900px;
                font-size: 14px;
            }
        }

        @media screen and (max-width: 767px) {

            /* Mobile devices */
            .game-container {
                max-width: 100%;
                padding: 20px;
                font-size: 12px;
            }
        }

        h1 {
            text-align: center;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 30px;
            font-size: clamp(2em, 5vw, 3em);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            animation: rainbow 3s ease infinite;
        }

        @keyframes rainbow {

            0%,
            100% {
                filter: hue-rotate(0deg);
            }

            50% {
                filter: hue-rotate(20deg);
            }
        }

        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .lang-btn {
            padding: 10px 15px;
            border: 2px solid #667eea;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .lang-btn:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }

        .lang-btn.active {
            background: #667eea;
            color: white;
        }

        .setup-screen,
        .game-screen {
            display: none;
        }

        .setup-screen.active,
        .game-screen.active {
            display: block;
        }

        .setup-section {
            margin-bottom: 30px;
            background: linear-gradient(135deg, #f3f4f6 0%, #e0e7ff 100%);
            padding: 25px;
            border-radius: 20px;
            border: 3px solid #667eea;
        }

        .setup-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: clamp(1.3em, 3vw, 1.8em);
            text-align: center;
        }

        .player-buttons,
        .age-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 20px 30px;
            font-size: clamp(1em, 2vw, 1.2em);
            border: 3px solid #667eea;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
            opacity: 0;
            transition: 0s;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-pressed {
            animation: pressAnimation 0.3s ease-in-out;
        }

        @keyframes pressAnimation {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(0.9);
            }

            100% {
                transform: scale(1);
            }
        }

        .btn-player,
        .btn-age {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            color: #667eea;
            flex: 1;
            min-width: 120px;
        }

        .btn-player:hover,
        .btn-age:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .btn-player.selected,
        .btn-age.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            animation: pulse-btn 1s infinite;
        }

        @keyframes pulse-btn {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            width: 100%;
            margin-top: 20px;
            font-size: clamp(1.2em, 2.5vw, 1.5em);
            padding: 25px;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .game-info {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 3px solid #f59e0b;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .game-info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: clamp(1em, 2vw, 1.2em);
            font-weight: bold;
        }

        .current-player {
            text-align: center;
            font-size: clamp(1.8em, 4vw, 2.5em);
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            font-weight: bold;
            animation: bounce 1s ease-in-out infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .dice-container {
            text-align: center;
            margin: 40px 0;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            padding: 40px;
            border-radius: 30px;
            border: 5px solid #d97706;
        }

        .dice {
            font-size: clamp(80px, 15vw, 120px);
            margin: 20px 0;
            display: inline-block;
            animation: float 2s ease-in-out infinite;
            text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.3);
            cursor: pointer;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px) rotate(0deg);
            }

            50% {
                transform: translateY(-15px) rotate(5deg);
            }
        }

        .dice.rolling {
            animation: roll-3d 0.8s cubic-bezier(0.36, 0.07, 0.19, 0.97);
        }

        @keyframes roll-3d {
            0% {
                transform: rotate(0deg) scale(1);
            }

            25% {
                transform: rotate(90deg) scale(1.2);
            }

            50% {
                transform: rotate(180deg) scale(1);
            }

            75% {
                transform: rotate(270deg) scale(1.2);
            }

            100% {
                transform: rotate(360deg) scale(1);
            }
        }

        .roll-instruction {
            font-size: clamp(1.1em, 2.2vw, 1.4em);
            color: #78350f;
            margin-bottom: 20px;
            font-weight: bold;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {

            0%,
            100% {
                text-shadow: 0 0 5px #fbbf24;
            }

            50% {
                text-shadow: 0 0 20px #fbbf24, 0 0 30px #f59e0b;
            }
        }

        .press-bar {
            width: 100%;
            height: 50px;
            background: white;
            border-radius: 25px;
            overflow: hidden;
            margin: 20px 0;
            border: 3px solid #d97706;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .press-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6, #ec4899, #f59e0b);
            width: 0%;
            transition: width 0.1s linear;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .activity-display {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 5px solid #f59e0b;
            border-radius: 25px;
            padding: 40px;
            margin: 30px 0;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .activity-display h3 {
            color: #92400e;
            font-size: clamp(1.5em, 3vw, 2em);
            margin-bottom: 20px;
        }

        .activity-display p {
            color: #78350f;
            font-size: 1.5em;
            line-height: 1.8;
            font-weight: bold;
        }

        .character-animation {
            width: clamp(200px, 40vw, 300px);
            height: clamp(250px, 45vw, 350px);
            margin: 20px auto;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .character {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Character HEAD - Clear and visible */
        .character-head {
            width: 90px;
            height: 90px;
            background: #fcc89b;
            border-radius: 50%;
            position: relative;
            border: 4px solid #333;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 10;
            margin-bottom: -10px;
        }

        /* Character EYES - Big and clear */
        .character-eye {
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 30px;
            border: 3px solid #333;
        }

        /* Eye pupils - black dots */
        .character-eye::after {
            content: '';
            width: 10px;
            height: 10px;
            background: #000;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: eyeBlink 4s ease-in-out infinite;
        }

        @keyframes eyeBlink {

            0%,
            96%,
            100% {
                opacity: 1;
            }

            98% {
                opacity: 0;
            }
        }

        .character-eye.left {
            left: 20px;
        }

        .character-eye.right {
            right: 20px;
        }

        /* Character MOUTH - Happy smile */
        .character-mouth {
            width: 40px;
            height: 20px;
            border: 4px solid #333;
            border-top: none;
            border-radius: 0 0 40px 40px;
            position: absolute;
            bottom: 18px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff6b9d;
        }

        /* Character BODY - Blue shirt, clearly visible */
        .character-body {
            width: 100px;
            height: 120px;
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            border-radius: 50px 50px 25px 25px;
            position: relative;
            border: 4px solid #2d5a8f;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: center;
            z-index: 5;
        }

        /* Character ARMS - Skin colored, sticking out from body */
        .character-arm {
            width: 25px;
            height: 70px;
            background: #fcc89b;
            border-radius: 12px;
            position: absolute;
            border: 3px solid #333;
            transform-origin: top center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .character-arm.left {
            left: -18px;
            top: 15px;
        }

        .character-arm.right {
            right: -18px;
            top: 15px;
        }

        /* Character LEGS - Dark blue pants */
        .character-leg {
            width: 28px;
            height: 60px;
            background: #2d5a8f;
            border-radius: 14px;
            position: absolute;
            bottom: -52px;
            border: 3px solid #1a3d5c;
            transform-origin: top center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .character-leg.left {
            left: 18px;
        }

        .character-leg.right {
            right: 18px;
        }

        /* Character FEET - shoes */
        .character-leg::after {
            content: '';
            width: 35px;
            height: 18px;
            background: #1a1a1a;
            border-radius: 15px 15px 8px 8px;
            position: absolute;
            bottom: -12px;
            left: -3px;
            border: 2px solid #000;
        }

        /* JUMPING Animation */
        .jumping .character-body {
            animation: jumpBody 0.6s ease-in-out infinite;
        }

        .jumping .character-head {
            animation: jumpHead 0.6s ease-in-out infinite;
        }

        .jumping .character-arm {
            animation: jumpArms 0.6s ease-in-out infinite;
        }

        .jumping .character-leg {
            animation: jumpLegs 0.6s ease-in-out infinite;
        }

        @keyframes jumpBody {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-30px);
            }
        }

        @keyframes jumpHead {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        @keyframes jumpArms {

            0%,
            100% {
                transform: rotate(0deg);
            }

            50% {
                transform: rotate(-25deg);
            }
        }

        @keyframes jumpLegs {

            0%,
            100% {
                transform: rotate(0deg);
            }

            25% {
                transform: rotate(-15deg);
            }

            75% {
                transform: rotate(15deg);
            }
        }

        /* DANCING Animation */
        .dancing .character-body {
            animation: danceBody 0.8s ease-in-out infinite;
        }

        .dancing .character-head {
            animation: danceHead 0.8s ease-in-out infinite;
        }

        .dancing .character-arm.left {
            animation: danceArmLeft 0.8s ease-in-out infinite;
        }

        .dancing .character-arm.right {
            animation: danceArmRight 0.8s ease-in-out infinite;
        }

        .dancing .character-leg.left {
            animation: danceLegLeft 0.8s ease-in-out infinite;
        }

        .dancing .character-leg.right {
            animation: danceLegRight 0.8s ease-in-out infinite;
        }

        @keyframes danceBody {

            0%,
            100% {
                transform: rotate(0deg);
            }

            25% {
                transform: rotate(-10deg);
            }

            75% {
                transform: rotate(10deg);
            }
        }

        @keyframes danceHead {

            0%,
            100% {
                transform: rotate(0deg);
            }

            25% {
                transform: rotate(-8deg);
            }

            75% {
                transform: rotate(8deg);
            }
        }

        @keyframes danceArmLeft {

            0%,
            100% {
                transform: rotate(0deg);
            }

            50% {
                transform: rotate(-50deg);
            }
        }

        @keyframes danceArmRight {

            0%,
            100% {
                transform: rotate(0deg);
            }

            50% {
                transform: rotate(50deg);
            }
        }

        @keyframes danceLegLeft {

            0%,
            100% {
                transform: rotate(0deg);
            }

            50% {
                transform: rotate(20deg);
            }
        }

        @keyframes danceLegRight {

            0%,
            100% {
                transform: rotate(0deg);
            }

            50% {
                transform: rotate(-20deg);
            }
        }

        /* SPINNING Animation */
        .spinning .character {
            animation: spinCharacter 1.2s linear infinite;
        }

        @keyframes spinCharacter {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* WAVING Animation */
        .waving .character-arm.right {
            animation: waveArm 0.5s ease-in-out infinite;
        }

        .waving .character-head {
            animation: waveHead 1s ease-in-out infinite;
        }

        @keyframes waveArm {

            0%,
            100% {
                transform: rotate(0deg);
            }

            25% {
                transform: rotate(-35deg);
            }

            75% {
                transform: rotate(-60deg);
            }
        }

        @keyframes waveHead {

            0%,
            100% {
                transform: rotate(0deg);
            }

            50% {
                transform: rotate(10deg);
            }
        }

        /* RUNNING Animation */
        .running .character-body {
            animation: runBody 0.4s ease-in-out infinite;
        }

        .running .character-arm.left {
            animation: runArmLeft 0.4s ease-in-out infinite;
        }

        .running .character-arm.right {
            animation: runArmRight 0.4s ease-in-out infinite;
        }

        .running .character-leg.left {
            animation: runLegLeft 0.4s ease-in-out infinite;
        }

        .running .character-leg.right {
            animation: runLegRight 0.4s ease-in-out infinite;
        }

        @keyframes runBody {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-8px);
            }
        }

        @keyframes runArmLeft {

            0%,
            100% {
                transform: rotate(-30deg);
            }

            50% {
                transform: rotate(30deg);
            }
        }

        @keyframes runArmRight {

            0%,
            100% {
                transform: rotate(30deg);
            }

            50% {
                transform: rotate(-30deg);
            }
        }

        @keyframes runLegLeft {

            0%,
            100% {
                transform: rotate(0deg);
            }

            50% {
                transform: rotate(35deg);
            }
        }

        @keyframes runLegRight {

            0%,
            100% {
                transform: rotate(0deg);
            }

            50% {
                transform: rotate(-35deg);
            }
        }


        .game-controls {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .help-button {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            font-size: 36px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
            z-index: 100;
        }

        .help-button:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: scale(1.15) rotate(15deg);
        }

        .volume-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .volume-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

        .volume-btn:hover {
            transform: scale(1.1);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 30px;
            padding: 40px;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            border: 5px solid #667eea;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 40px;
            cursor: pointer;
            color: #666;
            transition: all 0.3s;
        }

        .modal-close:hover {
            color: #667eea;
            transform: rotate(90deg) scale(1.2);
        }

        .modal h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: clamp(1.5em, 3vw, 2em);
        }

        .modal p,
        .modal ul {
            margin-bottom: 15px;
            line-height: 1.8;
            color: #333;
            font-size: 1.1em;
        }

        .scores-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .scores-table th,
        .scores-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 2px solid #e0e7ff;
        }

        .scores-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 1.2em;
        }

        .scores-table tr:hover {
            background: #f3f4f6;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spinner 1s linear infinite;
        }

        @keyframes spinner {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Layout Toggle Styles */
        .layout-toggle {
            position: fixed;
            top: 20px;
            right: 200px;
            z-index: 100;
        }

        .layout-btn {
            padding: 10px 15px;
            border: 2px solid #667eea;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s;
        }

        .layout-btn:hover {
            background: #667eea;
            transform: scale(1.05);
        }

        /* Portrait Layout */
        .layout-portrait .game-container {
            max-width: 600px !important;
            padding: 30px 20px;
        }

        .layout-portrait h1 {
            font-size: clamp(2em, 6vw, 2.5em);
        }

        .layout-portrait .dice {
            font-size: clamp(100px, 20vw, 140px);
        }

        .layout-portrait .character-animation {
            width: clamp(250px, 50vw, 350px);
            height: clamp(300px, 55vw, 400px);
        }

        /* History Button */
        .history-button {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: none;
            font-size: 36px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
            z-index: 100;
        }

        .history-button:hover {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            transform: scale(1.15) rotate(-15deg);
        }

        /* Settings Button */
        .settings-button {
            position: fixed;
            top: 100px;
            left: 20px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border: none;
            font-size: 36px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
            z-index: 100;
        }

        .settings-button:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            transform: scale(1.15) rotate(15deg);
        }

        /* History List */
        .history-list {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .history-session {
            background: #f3f4f6;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border: 2px solid #667eea;
        }

        .history-session h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .history-activity {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            font-size: 0.9em;
        }

        /* Custom Activities List */
        .activity-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 15px 0;
        }

        .activity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: #f3f4f6;
            border-radius: 8px;
            border: 1px solid #e0e7ff;
        }

        .activity-item:hover {
            background: #e0e7ff;
        }

        .activity-actions {
            display: flex;
            gap: 5px;
        }

        .btn-icon {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .btn-edit {
            background: #3b82f6;
            color: white;
        }

        .btn-delete {
            background: #ef4444;
            color: white;
        }

        .btn-icon:hover {
            transform: scale(1.1);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e7ff;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 0.9em;
            margin-right: 10px;
        }

        @media (max-width: 600px) {
            .game-container {
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }

            .dice {
                font-size: 80px;
            }

            .character-animation {
                width: 200px;
                height: 200px;
            }
        }
    </style>
</head>

<body>
    <button class="help-button" onclick="showHelp()">?</button>
    <button class="history-button" onclick="showHistory()">üìú</button>
    <button class="settings-button" onclick="showSettings()">‚öôÔ∏è</button>

    <div class="layout-toggle">
        <button class="layout-btn" id="layoutBtn" onclick="toggleLayout()">üñ•Ô∏è</button>
    </div>

    <div class="volume-control">
        <button class="volume-btn" id="volumeBtn" onclick="toggleMute()">üîä</button>
    </div>

    <div class="game-container">
        <div class="language-selector">
            <button class="lang-btn active" onclick="changeLanguage('en')" data-lang="en">üá¨üáß EN</button>
            <button class="lang-btn" onclick="changeLanguage('ne')" data-lang="ne">üá≥üáµ NE</button>
            <button class="lang-btn" onclick="changeLanguage('nl')" data-lang="nl">üá≥üá± NL</button>
        </div>

        <h1 id="gameTitle">üé≤ Activity 1,2,3 üé≤</h1>

        <!-- Setup Screen -->
        <div class="setup-screen active">
            <div class="setup-section">
                <h2 id="selectPlayersText">Select Number of Players</h2>
                <div class="player-buttons">
                    <button class="btn btn-player" onclick="selectPlayers(1, this)">1 <span
                            id="playerText1">Player</span></button>
                    <button class="btn btn-player" onclick="selectPlayers(2, this)">2 <span
                            id="playerText2">Players</span></button>
                    <button class="btn btn-player" onclick="selectPlayers(3, this)">3 <span
                            id="playerText3">Players</span></button>
                    <button class="btn btn-player" onclick="selectPlayers(4, this)">4 <span
                            id="playerText4">Players</span></button>
                </div>
            </div>

            <div class="setup-section">
                <h2 id="selectAgeText">Select Age Group</h2>
                <div class="age-buttons">
                    <button class="btn btn-age" onclick="selectAge('kids', this)">
                        <span id="kidsText">Kids (3-9 years)</span>
                    </button>
                    <button class="btn btn-age" onclick="selectAge('adult', this)">
                        <span id="adultsText">Adults</span>
                    </button>
                </div>
            </div>

            <button class="btn btn-player" style="width: 100%; margin-top: 15px;" onclick="showManageActivities()"
                id="manageActivitiesBtn">üéØ Manage Activities</button>

            <button class="btn btn-primary" onclick="startGame()" id="startGameBtn">Start Game</button>
        </div>

        <!-- Game Screen -->
        <div class="game-screen">
            <div class="game-info">
                <div class="game-info-row">
                    <strong id="playersLabel">Players:</strong>
                    <span id="playerCount">0</span>
                </div>
                <div class="game-info-row">
                    <strong id="ageGroupLabel">Age Group:</strong>
                    <span id="ageGroup">-</span>
                </div>
                <div class="game-info-row">
                    <strong id="roundLabel">Round:</strong>
                    <span id="roundInfo">1 / 12</span>
                </div>
            </div>

            <div class="current-player">
                <span id="playerTurnText">Player</span> <span id="currentPlayerNum">1</span>'s <span
                    id="turnText">Turn</span>
            </div>

            <div class="dice-container">
                <div class="roll-instruction" id="rollInstruction">Press and hold SPACE to roll the dice!</div>
                <div class="press-bar">
                    <div class="press-bar-fill" id="pressBar"></div>
                </div>
                <div class="dice" id="dice">üé≤</div>
            </div>

            <div class="activity-display" id="activityDisplay" style="display: none;">
                <h3 id="activityTitle">Your Activity:</h3>

                <div class="character-animation" id="characterAnimation">
                    <div class="character" id="character">
                        <div class="character-head">
                            <div class="character-eye left"></div>
                            <div class="character-eye right"></div>
                            <div class="character-mouth"></div>
                        </div>
                        <div class="character-body">
                            <div class="character-arm left"></div>
                            <div class="character-arm right"></div>
                            <div class="character-leg left"></div>
                            <div class="character-leg right"></div>
                        </div>
                    </div>
                </div>

                <p id="activityText">Loading...</p>
            </div>

            <div class="game-controls">
                <button class="btn btn-secondary"
                    style="flex: 1; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;"
                    onclick="nextTurn()" id="nextPlayerBtn">Next Player</button>
                <button class="btn btn-player" style="flex: 1;" onclick="restartGame()" id="newGameBtn">New
                    Game</button>
            </div>

            <div style="margin-top: 30px;">
                <h3 style="color: #667eea; margin-bottom: 15px;" id="progressLabel">Game Progress</h3>
                <table class="scores-table">
                    <thead>
                        <tr>
                            <th id="playerHeader">Player</th>
                            <th id="completedHeader">Activities Completed</th>
                        </tr>
                    </thead>
                    <tbody id="scoreBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeHelp()">&times;</span>
            <h2 id="helpTitle">How to Play Activity 1,2,3</h2>
            <div id="helpContent"></div>
        </div>
    </div>

    <script>
        // Translations
        const translations = {
            en: {
                gameTitle: "üé≤ Activity 1,2,3 üé≤",
                selectPlayers: "Select Number of Players",
                player: "Player",
                players: "Players",
                selectAge: "Select Age Group",
                kids: "Kids (3-9 years)",
                adults: "Adults",
                startGame: "Start Game",
                playersLabel: "Players:",
                ageGroupLabel: "Age Group:",
                roundLabel: "Round:",
                playerTurn: "Player",
                turn: "Turn",
                rollInstruction: "Press and hold SPACE to roll the dice!",
                yourActivity: "Your Activity:",
                nextPlayer: "Next Player",
                newGame: "New Game",
                progress: "Game Progress",
                playerHeader: "Player",
                completedHeader: "Activities Completed",
                helpTitle: "How to Play Activity 1,2,3",
                gameOver: "Game Over! All players completed 12 rounds!\n\nThanks for playing Activity 1,2,3!",
                selectPlayersAlert: "Please select the number of players!",
                selectAgeAlert: "Please select an age group!"
            },
            ne: {
                gameTitle: "üé≤ ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡•ß,‡•®,‡•© üé≤",
                selectPlayers: "‡§ñ‡•á‡§≤‡§æ‡§°‡•Ä‡§π‡§∞‡•Ç‡§ï‡•ã ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç",
                player: "‡§ñ‡•á‡§≤‡§æ‡§°‡•Ä",
                players: "‡§ñ‡•á‡§≤‡§æ‡§°‡•Ä‡§π‡§∞‡•Ç",
                selectAge: "‡§â‡§Æ‡•á‡§∞ ‡§∏‡§Æ‡•Ç‡§π ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç",
                kids: "‡§¨‡§æ‡§≤‡§¨‡§æ‡§≤‡§ø‡§ï‡§æ (‡•©-‡•Ø ‡§µ‡§∞‡•ç‡§∑)",
                adults: "‡§µ‡§Ø‡§∏‡•ç‡§ï‡§π‡§∞‡•Ç",
                startGame: "‡§ñ‡•á‡§≤ ‡§∏‡•Å‡§∞‡•Å ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç",
                playersLabel: "‡§ñ‡•á‡§≤‡§æ‡§°‡•Ä‡§π‡§∞‡•Ç:",
                ageGroupLabel: "‡§â‡§Æ‡•á‡§∞ ‡§∏‡§Æ‡•Ç‡§π:",
                roundLabel: "‡§∞‡§æ‡§â‡§®‡•ç‡§°:",
                playerTurn: "‡§ñ‡•á‡§≤‡§æ‡§°‡•Ä",
                turn: "‡§™‡§æ‡§≤‡•ã",
                rollInstruction: "‡§™‡§æ‡§∏‡§æ ‡§ò‡•Å‡§Æ‡§æ‡§â‡§® SPACE ‡§•‡§ø‡§ö‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡§∞ ‡§π‡•ã‡§≤‡•ç‡§° ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!",
                yourActivity: "‡§§‡§™‡§æ‡§à‡§Ç‡§ï‡•ã ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø:",
                nextPlayer: "‡§Ö‡§∞‡•ç‡§ï‡•ã ‡§ñ‡•á‡§≤‡§æ‡§°‡•Ä",
                newGame: "‡§®‡§Ø‡§æ‡§Å ‡§ñ‡•á‡§≤",
                progress: "‡§ñ‡•á‡§≤ ‡§™‡•ç‡§∞‡§ó‡§§‡§ø",
                playerHeader: "‡§ñ‡•á‡§≤‡§æ‡§°‡•Ä",
                completedHeader: "‡§™‡•Ç‡§∞‡§æ ‡§ó‡§∞‡§ø‡§è‡§ï‡§æ ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø‡§π‡§∞‡•Ç",
                helpTitle: "‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡•ß,‡•®,‡•© ‡§ï‡§∏‡§∞‡•Ä ‡§ñ‡•á‡§≤‡•ç‡§®‡•á",
                gameOver: "‡§ñ‡•á‡§≤ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§≠‡§Ø‡•ã! ‡§∏‡§¨‡•à ‡§ñ‡•á‡§≤‡§æ‡§°‡•Ä‡§π‡§∞‡•Ç‡§≤‡•á ‡•ß‡•® ‡§∞‡§æ‡§â‡§®‡•ç‡§° ‡§™‡•Ç‡§∞‡§æ ‡§ó‡§∞‡•á!\n\n‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡•ß,‡•®,‡•© ‡§ñ‡•á‡§≤‡•ç‡§®‡•Å‡§≠‡§è‡§ï‡•ã‡§Æ‡§æ ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!",
                selectPlayersAlert: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§ñ‡•á‡§≤‡§æ‡§°‡•Ä‡§π‡§∞‡•Ç‡§ï‡•ã ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!",
                selectAgeAlert: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§â‡§Æ‡•á‡§∞ ‡§∏‡§Æ‡•Ç‡§π ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!"
            },
            nl: {
                gameTitle: "üé≤ Activiteit 1,2,3 üé≤",
                selectPlayers: "Selecteer Aantal Spelers",
                player: "Speler",
                players: "Spelers",
                selectAge: "Selecteer Leeftijdsgroep",
                kids: "Kinderen (3-9 jaar)",
                adults: "Volwassenen",
                startGame: "Start Spel",
                playersLabel: "Spelers:",
                ageGroupLabel: "Leeftijdsgroep:",
                roundLabel: "Ronde:",
                playerTurn: "Speler",
                turn: "Beurt",
                rollInstruction: "Druk en houd SPATIE in om de dobbelstenen te gooien!",
                yourActivity: "Jouw Activiteit:",
                nextPlayer: "Volgende Speler",
                newGame: "Nieuw Spel",
                progress: "Spelvoortgang",
                playerHeader: "Speler",
                completedHeader: "Voltooide Activiteiten",
                helpTitle: "Hoe Speel Je Activiteit 1,2,3",
                gameOver: "Spel Afgelopen! Alle spelers hebben 12 rondes voltooid!\n\nBedankt voor het spelen van Activiteit 1,2,3!",
                selectPlayersAlert: "Selecteer alstublieft het aantal spelers!",
                selectAgeAlert: "Selecteer alstublieft een leeftijdsgroep!"
            }
        };

        let currentLanguage = 'en';
        let isMuted = false;

        // Sound effects using Web Audio API - Lazy loaded
        let audioContext = null;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                console.log("Audio Context Initialized");
            }
            if (audioContext.state === 'suspended') {
                audioContext.resume();
                console.log("Audio Context Resumed");
            }
            return audioContext;
        }

        function playSound(type) {
            if (isMuted) return;

            const ctx = initAudio();
            if (!ctx) return;

            const oscillator = ctx.createOscillator();
            const gainNode = ctx.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(ctx.destination);

            switch (type) {
                case 'click':
                    oscillator.frequency.value = 800;
                    gainNode.gain.value = 0.3;
                    oscillator.start();
                    oscillator.stop(ctx.currentTime + 0.1);
                    break;
                case 'select':
                    oscillator.frequency.value = 1000;
                    gainNode.gain.value = 0.3;
                    oscillator.start();
                    oscillator.stop(ctx.currentTime + 0.15);
                    break;
                case 'roll':
                    // Rolling sound effect
                    for (let i = 0; i < 10; i++) {
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        osc.connect(gain);
                        gain.connect(ctx.destination);
                        osc.frequency.value = 200 + Math.random() * 200;
                        gain.gain.value = 0.1;
                        osc.start(ctx.currentTime + i * 0.05);
                        osc.stop(ctx.currentTime + i * 0.05 + 0.05);
                    }
                    break;
                case 'success':
                    oscillator.type = 'sine';
                    oscillator.frequency.value = 523.25;
                    gainNode.gain.value = 0.3;
                    oscillator.start();
                    oscillator.stop(ctx.currentTime + 0.2);
                    setTimeout(() => {
                        const osc2 = ctx.createOscillator();
                        const gain2 = ctx.createGain();
                        osc2.connect(gain2);
                        gain2.connect(ctx.destination);
                        osc2.frequency.value = 659.25;
                        gain2.gain.value = 0.3;
                        osc2.start();
                        osc2.stop(ctx.currentTime + 0.3);
                    }, 200);
                    break;
                case 'celebrate':
                    for (let i = 0; i < 5; i++) {
                        setTimeout(() => {
                            const osc = ctx.createOscillator();
                            const gain = ctx.createGain();
                            osc.connect(gain);
                            gain.connect(ctx.destination);
                            osc.frequency.value = 440 * Math.pow(2, i / 12);
                            gain.gain.value = 0.2;
                            osc.start();
                            osc.stop(ctx.currentTime + 0.1);
                        }, i * 100);
                    }
                    break;
            }
        }

        function toggleMute() {
            isMuted = !isMuted;
            document.getElementById('volumeBtn').textContent = isMuted ? 'üîá' : 'üîä';
            playSound('click');
        }

        function changeLanguage(lang) {
            currentLanguage = lang;
            playSound('select');

            // Update active button
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-lang') === lang) {
                    btn.classList.add('active');
                }
            });

            updateUILanguage();
        }

        function updateUILanguage() {
            const t = translations[currentLanguage];

            document.getElementById('gameTitle').textContent = t.gameTitle;
            document.getElementById('selectPlayersText').textContent = t.selectPlayers;
            document.getElementById('playerText1').textContent = t.player;
            document.getElementById('playerText2').textContent = t.players;
            document.getElementById('playerText3').textContent = t.players;
            document.getElementById('playerText4').textContent = t.players;
            document.getElementById('selectAgeText').textContent = t.selectAge;
            document.getElementById('kidsText').textContent = t.kids;
            document.getElementById('adultsText').textContent = t.adults;
            document.getElementById('startGameBtn').textContent = t.startGame;
            document.getElementById('playersLabel').textContent = t.playersLabel;
            document.getElementById('ageGroupLabel').textContent = t.ageGroupLabel;
            document.getElementById('roundLabel').textContent = t.roundLabel;
            document.getElementById('playerTurnText').textContent = t.playerTurn;
            document.getElementById('turnText').textContent = t.turn;
            document.getElementById('rollInstruction').textContent = t.rollInstruction;
            document.getElementById('activityTitle').textContent = t.yourActivity;
            document.getElementById('nextPlayerBtn').textContent = t.nextPlayer;
            document.getElementById('newGameBtn').textContent = t.newGame;
            document.getElementById('progressLabel').textContent = t.progress;
            document.getElementById('playerHeader').textContent = t.playerHeader;
            document.getElementById('completedHeader').textContent = t.completedHeader;
            document.getElementById('helpTitle').textContent = t.helpTitle;
        }

        function speakText(text, lang) {
            if (isMuted || !('speechSynthesis' in window)) return;

            // Cancel any ongoing speech immediately
            window.speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance(text);

            // Set language based on current selection
            const langMap = { 'en': 'en-US', 'ne': 'ne-NP', 'nl': 'nl-NL' };
            utterance.lang = langMap[lang] || 'en-US';

            // Faster speech settings for quicker playback
            utterance.rate = 1.0;
            utterance.pitch = 1.1;
            utterance.volume = 1;

            // Ensure speech synthesis is active (Edge workaround)
            if (window.speechSynthesis.paused) {
                window.speechSynthesis.resume();
            }

            // Use requestAnimationFrame for faster scheduling
            requestAnimationFrame(() => {
                window.speechSynthesis.speak(utterance);
            });
        }

        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = ['#667eea', '#764ba2', '#f093fb', '#10b981', '#fbbf24'][Math.floor(Math.random() * 5)];
                    confetti.style.animationDuration = (Math.random() * 2 + 1) + 's';
                    document.body.appendChild(confetti);

                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
        }

        let gameState = {
            numPlayers: 0,
            ageGroup: '',
            currentPlayer: 1,
            currentRound: 1,
            maxRounds: 12,
            playerScores: [],
            isRolling: false,
            pressStartTime: 0,
            pressValue: 0,
            lastRoll: 0
        };

        function selectPlayers(num, btnElement) {
            console.log("Selecting players:", num);

            // Initialize audio on first interaction
            initAudio();

            gameState.numPlayers = num;
            playSound('select');
            document.querySelectorAll('.btn-player').forEach(btn => btn.classList.remove('selected'));
            if (btnElement) {
                btnElement.classList.add('selected');
            }
        }

        function selectAge(age, btnElement) {
            console.log("Selecting age:", age);

            // Initialize audio on first interaction
            initAudio();

            gameState.ageGroup = age;
            playSound('select');
            document.querySelectorAll('.btn-age').forEach(btn => btn.classList.remove('selected'));
            if (btnElement) {
                btnElement.classList.add('selected');
            }
        }

        function startGame() {
            // First interact - initialize audio
            initAudio();

            console.log("startGame called. Current State:", gameState);
            const t = translations[currentLanguage];

            if (gameState.numPlayers === 0) {
                alert(t.selectPlayersAlert);
                console.error("Start failed: No players selected");
                return;
            }
            if (gameState.ageGroup === '') {
                alert(t.selectAgeAlert);
                console.error("Start failed: No age group selected");
                return;
            }

            console.log("Game starting successfully!");
            playSound('success');
            createConfetti();

            gameState.playerScores = Array(gameState.numPlayers).fill(0);

            document.getElementById('playerCount').textContent = gameState.numPlayers;
            document.getElementById('ageGroup').textContent = gameState.ageGroup === 'kids' ? t.kids : t.adults;

            updateScoreTable();

            document.querySelector('.setup-screen').classList.remove('active');
            document.querySelector('.game-screen').classList.add('active');
        }

        // Global click listener for visual feedback and audio init
        document.addEventListener('click', function (e) {
            // Initialize audio on first click anywhere
            initAudio();

            // Handle button press animation
            const btn = e.target.closest('.btn');
            if (btn) {
                playSound('click'); // Play click sound for all buttons

                // Remove class if it exists to restart animation
                btn.classList.remove('btn-pressed');
                // Trigger reflow
                void btn.offsetWidth;
                // Add class
                btn.classList.add('btn-pressed');

                // Remove class after animation
                setTimeout(() => {
                    btn.classList.remove('btn-pressed');
                }, 300);
            }
        });

        // Add page load handler
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Game loaded! Click any button to enable sound.');
            document.body.addEventListener('click', function () {
                initAudio();
                console.log('Audio system ready');
            }, { once: true });
        });

        function updateScoreTable() {
            const tbody = document.getElementById('scoreBody');
            const t = translations[currentLanguage];
            tbody.innerHTML = '';
            for (let i = 0; i < gameState.numPlayers; i++) {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${t.playerTurn} ${i + 1}</td>
                    <td>${gameState.playerScores[i]} / 12</td>
                `;
            }
        }

        let pressInterval;

        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && document.querySelector('.game-screen').classList.contains('active')) {
                e.preventDefault();

                // If activity is displayed, pressing space advances to next player
                const activityDisplay = document.getElementById('activityDisplay');
                if (activityDisplay && activityDisplay.style.display !== 'none' && !gameState.isRolling) {
                    nextTurn();
                    return;
                }

                // Otherwise, start rolling dice
                if (!gameState.isRolling && gameState.pressStartTime === 0) {
                    gameState.pressStartTime = Date.now();
                    pressInterval = setInterval(updatePressBar, 50);
                }
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.code === 'Space' && gameState.pressStartTime > 0) {
                e.preventDefault();
                clearInterval(pressInterval);
                rollDice();
            }
        });

        function updatePressBar() {
            const elapsed = Date.now() - gameState.pressStartTime;
            gameState.pressValue = Math.min(elapsed / 20, 100);
            document.getElementById('pressBar').style.width = gameState.pressValue + '%';
        }

        function rollDice() {
            if (gameState.isRolling) return;

            gameState.isRolling = true;
            playSound('roll');

            const diceElement = document.getElementById('dice');
            diceElement.classList.add('rolling');

            document.getElementById('activityDisplay').style.display = 'none';

            const iterations = Math.floor(10 + (gameState.pressValue / 10));
            let counter = 0;

            const rollInterval = setInterval(() => {
                const tempRoll = Math.floor(Math.random() * 6) + 1;
                diceElement.textContent = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'][tempRoll - 1];
                counter++;

                if (counter >= iterations) {
                    clearInterval(rollInterval);
                    const finalRoll = Math.floor(Math.random() * 6) + 1;
                    gameState.lastRoll = finalRoll;
                    diceElement.textContent = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'][finalRoll - 1];
                    diceElement.classList.remove('rolling');

                    playSound('success');

                    setTimeout(() => {
                        showActivity(finalRoll);
                        gameState.isRolling = false;
                        gameState.pressStartTime = 0;
                        gameState.pressValue = 0;
                        document.getElementById('pressBar').style.width = '0%';
                    }, 500);
                }
            }, 100);
        }

        async function showActivity(diceNumber) {
            const activityDisplay = document.getElementById('activityDisplay');
            const activityText = document.getElementById('activityText');

            activityDisplay.style.display = 'block';

            // Generate activity first (may be instant for fallback)
            const activities = await generateMultilingualActivity(diceNumber);

            // Display and speak IMMEDIATELY (before confetti/animations)
            activityText.textContent = activities[currentLanguage];

            // Speak first for faster audio response
            speakText(activities[currentLanguage], currentLanguage);

            // Then do visual effects
            playSound('celebrate');
            createConfetti();

            // Animate character based on activity type
            animateCharacter(activities[currentLanguage]);
        }

        async function generateMultilingualActivity(diceNumber) {
            try {
                // Get settings
                const settings = JSON.parse(localStorage.getItem('activityGame_settings') || '{"aiProvider":"none"}');

                // If no AI provider selected, use fallback
                if (settings.aiProvider === 'none' || !settings.apiKey) {
                    return getFallbackActivity(diceNumber);
                }

                const ageContext = gameState.ageGroup === 'kids'
                    ? 'a child aged 3-9 years old'
                    : 'an adult';

                const prompt = `Generate a fun, safe, and engaging physical or creative activity for ${ageContext}. The activity should be simple, take 15-30 seconds to complete, and be appropriate for playing at home. 

Provide the activity in three languages with the following JSON format:
{
    "en": "activity in English",
    "ne": "‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§®‡•á‡§™‡§æ‡§≤‡•Ä‡§Æ‡§æ",
    "nl": "activiteit in het Nederlands"
}

Just provide the JSON object with translations, no explanation needed. Make it fun and energetic!`;

                let response;

                // Call appropriate AI API based on provider
                if (settings.aiProvider === 'anthropic') {
                    response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "x-api-key": settings.apiKey,
                            "anthropic-version": "2023-06-01"
                        },
                        body: JSON.stringify({
                            model: "claude-3-5-sonnet-20241022",
                            max_tokens: 1000,
                            messages: [
                                { role: "user", content: prompt }
                            ],
                        })
                    });
                } else if (settings.aiProvider === 'openai') {
                    response = await fetch("https://api.openai.com/v1/chat/completions", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${settings.apiKey}`
                        },
                        body: JSON.stringify({
                            model: "gpt-4",
                            messages: [
                                { role: "user", content: prompt }
                            ],
                            temperature: 0.9
                        })
                    });
                } else if (settings.aiProvider === 'gemini') {
                    response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${settings.apiKey}`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{ text: prompt }]
                            }]
                        })
                    });
                } else if (settings.aiProvider === 'perplexity') {
                    response = await fetch("https://api.perplexity.ai/chat/completions", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${settings.apiKey}`
                        },
                        body: JSON.stringify({
                            model: "sonar",
                            messages: [
                                { role: "system", content: "You are a helpful assistant that generates JSON." },
                                { role: "user", content: prompt }
                            ]
                        })
                    });
                }

                const data = await response.json();

                // Parse response based on provider
                let activityText = '';
                if (settings.aiProvider === 'anthropic' && data.content) {
                    activityText = data.content[0].text;
                } else if ((settings.aiProvider === 'openai' || settings.aiProvider === 'perplexity') && data.choices) {
                    activityText = data.choices[0].message.content;
                } else if (settings.aiProvider === 'gemini' && data.candidates) {
                    activityText = data.candidates[0].content.parts[0].text;
                }

                // Extract JSON from response
                const jsonMatch = activityText.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                }

                // Fallback
                return getFallbackActivity(diceNumber);
            } catch (error) {
                console.error('Error generating AI activity:', error);
                return getFallbackActivity(diceNumber);
            }
        }

        function getFallbackActivity(diceNumber) {
            const fallbacks = {
                kids: {
                    1: {
                        en: "Jump like a bunny 10 times!",
                        ne: "‡§ñ‡§∞‡§æ‡§Ø‡•ã ‡§ú‡§∏‡•ç‡§§‡•à ‡•ß‡•¶ ‡§™‡§ü‡§ï ‡§â‡§´‡•ç‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!",
                        nl: "Spring als een konijn 10 keer!"
                    },
                    2: {
                        en: "Spin around 3 times!",
                        ne: "‡•© ‡§™‡§ü‡§ï ‡§ò‡•Å‡§Æ‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!",
                        nl: "Draai 3 keer rond!"
                    },
                    3: {
                        en: "Dance for 15 seconds!",
                        ne: "‡•ß‡•´ ‡§∏‡•á‡§ï‡•á‡§®‡•ç‡§° ‡§®‡§æ‡§ö‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!",
                        nl: "Dans 15 seconden!"
                    },
                    4: {
                        en: "Make a funny face!",
                        ne: "‡§π‡§æ‡§∏‡•ç‡§Ø‡§æ‡§∏‡•ç‡§™‡§¶ ‡§Ö‡§®‡•Å‡§π‡§æ‡§∞ ‡§¨‡§®‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç!",
                        nl: "Maak een grappig gezicht!"
                    },
                    5: {
                        en: "Sing a song!",
                        ne: "‡§ó‡•Ä‡§§ ‡§ó‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç!",
                        nl: "Zing een liedje!"
                    },
                    6: {
                        en: "Tell a joke!",
                        ne: "‡§ö‡•Å‡§ü‡§ï‡§ø‡§≤‡§æ ‡§∏‡•Å‡§®‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç!",
                        nl: "Vertel een grap!"
                    }
                },
                adult: {
                    1: {
                        en: "Do 10 jumping jacks!",
                        ne: "‡•ß‡•¶ ‡§ú‡§Æ‡•ç‡§™‡§ø‡§ô ‡§ú‡•ç‡§Ø‡§æ‡§ï ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!",
                        nl: "Doe 10 jumping jacks!"
                    },
                    2: {
                        en: "Hold a plank for 15 seconds!",
                        ne: "‡•ß‡•´ ‡§∏‡•á‡§ï‡•á‡§®‡•ç‡§° ‡§™‡•ç‡§≤‡•ç‡§Ø‡§æ‡§ô‡•ç‡§ï ‡§π‡•ã‡§≤‡•ç‡§° ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!",
                        nl: "Houd een plank 15 seconden vast!"
                    },
                    3: {
                        en: "Dance freestyle for 20 seconds!",
                        ne: "‡•®‡•¶ ‡§∏‡•á‡§ï‡•á‡§®‡•ç‡§° ‡§´‡•ç‡§∞‡•Ä‡§∏‡•ç‡§ü‡§æ‡§á‡§≤ ‡§®‡§æ‡§ö‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!",
                        nl: "Dans 20 seconden freestyle!"
                    },
                    4: {
                        en: "Do an impression of someone!",
                        ne: "‡§ï‡§∏‡•à‡§ï‡•ã ‡§®‡§ï‡•ç‡§ï‡§≤ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!",
                        nl: "Doe een imitatie van iemand!"
                    },
                    5: {
                        en: "Share an interesting fact!",
                        ne: "‡§∞‡•ã‡§ö‡§ï ‡§§‡§•‡•ç‡§Ø ‡§∏‡§æ‡§ù‡§æ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!",
                        nl: "Deel een interessant feit!"
                    },
                    6: {
                        en: "Tell your best joke!",
                        ne: "‡§Ü‡§´‡•ç‡§®‡•ã ‡§â‡§§‡•ç‡§§‡§Æ ‡§ö‡•Å‡§ü‡§ï‡§ø‡§≤‡§æ ‡§∏‡•Å‡§®‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç!",
                        nl: "Vertel je beste grap!"
                    }
                }
            };

            // Try to include custom activities
            let customActs = [];
            try {
                const customs = JSON.parse(localStorage.getItem('activityGame_customActivities') || '{"kids":[],"adult":[]}');
                customActs = customs[gameState.ageGroup] || [];
            } catch (e) { }

            // If we have custom activities, randomly choose between fallback and custom
            if (customActs.length & gt; 0 & amp;& amp; Math.random() & gt; 0.5) {
                const randomCustom = customActs[Math.floor(Math.random() * customActs.length)];
                return randomCustom;
            }

            return fallbacks[gameState.ageGroup][diceNumber];
        }

        function animateCharacter(activityText) {
            const character = document.getElementById('character');
            const characterAnimation = document.getElementById('characterAnimation');

            // Remove all animation classes
            characterAnimation.className = 'character-animation';

            // Determine animation based on activity keywords
            const text = activityText.toLowerCase();

            if (text.includes('jump') || text.includes('‡§â‡§´‡•ç‡§∞') || text.includes('spring')) {
                characterAnimation.classList.add('jumping');
            } else if (text.includes('dance') || text.includes('‡§®‡§æ‡§ö') || text.includes('dans')) {
                characterAnimation.classList.add('dancing');
            } else if (text.includes('spin') || text.includes('‡§ò‡•Å‡§Æ') || text.includes('draai')) {
                characterAnimation.classList.add('spinning');
            } else {
                characterAnimation.classList.add('waving');
            }
        }

        function nextTurn() {
            playSound('success');

            // Record activity history
            const activityText = document.getElementById('activityText').textContent;
            if (activityText && typeof recordActivity === 'function') {
                recordActivity(gameState.currentPlayer, activityText);
            }

            gameState.playerScores[gameState.currentPlayer - 1]++;
            gameState.currentPlayer++;

            if (gameState.currentPlayer > gameState.numPlayers) {
                gameState.currentPlayer = 1;
                gameState.currentRound++;
            }

            if (gameState.currentRound > gameState.maxRounds) {
                const t = translations[currentLanguage];
                playSound('celebrate');
                createConfetti();
                alert(t.gameOver);
                restartGame();
                return;
            }

            document.getElementById('currentPlayerNum').textContent = gameState.currentPlayer;
            document.getElementById('roundInfo').textContent = `${gameState.currentRound} / ${gameState.maxRounds}`;
            document.getElementById('activityDisplay').style.display = 'none';
            document.getElementById('dice').textContent = 'üé≤';

            updateScoreTable();
        }

        function restartGame() {
            playSound('click');

            gameState = {
                numPlayers: 0,
                ageGroup: '',
                currentPlayer: 1,
                currentRound: 1,
                maxRounds: 12,
                playerScores: [],
                isRolling: false,
                pressStartTime: 0,
                pressValue: 0,
                lastRoll: 0
            };

            document.querySelector('.game-screen').classList.remove('active');
            document.querySelector('.setup-screen').classList.add('active');
            document.querySelectorAll('.btn-player, .btn-age').forEach(btn => btn.classList.remove('selected'));
        }

        function showHelp() {
            playSound('click');

            const helpContent = {
                en: `
                    <h3>Game Setup:</h3>
                    <ul>
                        <li>Choose the number of players (1-4)</li>
                        <li>Select an age group (Kids 3-9 or Adults)</li>
                        <li>Click "Start Game" to begin</li>
                    </ul>
                    <h3>How to Roll the Dice:</h3>
                    <ul>
                        <li>Press and hold the SPACEBAR on your keyboard</li>
                        <li>The longer you hold, the more the bar fills up</li>
                        <li>Release to roll the dice!</li>
                    </ul>
                    <h3>Language & Audio:</h3>
                    <ul>
                        <li>Use language buttons (EN/NE/NL) to change interface language</li>
                        <li>Activities are spoken in all three languages</li>
                        <li>Use the volume button to mute/unmute sounds</li>
                    </ul>
                    <h3>Game Rules:</h3>
                    <ul>
                        <li>Each player takes turns rolling the dice</li>
                        <li>Watch the cartoon character demonstrate the activity</li>
                        <li>Listen to the activity in multiple languages</li>
                        <li>Complete the activity shown on screen</li>
                        <li>Click "Next Player" when done</li>
                        <li>The game lasts for 12 rounds</li>
                    </ul>
                `,
                ne: `
                    <h3>‡§ñ‡•á‡§≤ ‡§∏‡•á‡§ü‡§Ö‡§™:</h3>
                    <ul>
                        <li>‡§ñ‡•á‡§≤‡§æ‡§°‡•Ä‡§π‡§∞‡•Ç‡§ï‡•ã ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç (‡•ß-‡•™)</li>
                        <li>‡§â‡§Æ‡•á‡§∞ ‡§∏‡§Æ‡•Ç‡§π ‡§õ‡§æ‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç (‡§¨‡§æ‡§≤‡§¨‡§æ‡§≤‡§ø‡§ï‡§æ ‡•©-‡•Ø ‡§µ‡§æ ‡§µ‡§Ø‡§∏‡•ç‡§ï‡§π‡§∞‡•Ç)</li>
                        <li>‡§∏‡•Å‡§∞‡•Å ‡§ó‡§∞‡•ç‡§® "‡§ñ‡•á‡§≤ ‡§∏‡•Å‡§∞‡•Å ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç" ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</li>
                    </ul>
                    <h3>‡§™‡§æ‡§∏‡§æ ‡§ï‡§∏‡§∞‡•Ä ‡§ò‡•Å‡§Æ‡§æ‡§â‡§®‡•á:</h3>
                    <ul>
                        <li>‡§ï‡§ø‡§¨‡•ã‡§∞‡•ç‡§°‡§Æ‡§æ SPACEBAR ‡§•‡§ø‡§ö‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡§∞ ‡§π‡•ã‡§≤‡•ç‡§° ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</li>
                        <li>‡§ú‡§§‡§ø ‡§≤‡§æ‡§Æ‡•ã ‡§∏‡§Æ‡§Ø ‡§π‡•ã‡§≤‡•ç‡§° ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•Å‡§®‡•ç‡§õ, ‡§¨‡§æ‡§∞ ‡§§‡•ç‡§Ø‡§§‡§ø ‡§≠‡§∞‡§ø‡§®‡•ç‡§õ</li>
                        <li>‡§™‡§æ‡§∏‡§æ ‡§ò‡•Å‡§Æ‡§æ‡§â‡§® ‡§õ‡•ã‡§°‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç!</li>
                    </ul>
                    <h3>‡§≠‡§æ‡§∑‡§æ ‡§∞ ‡§Ö‡§°‡§ø‡§Ø‡•ã:</h3>
                    <ul>
                        <li>‡§á‡§®‡•ç‡§ü‡§∞‡§´‡•á‡§∏ ‡§≠‡§æ‡§∑‡§æ ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§® ‡§ó‡§∞‡•ç‡§® ‡§≠‡§æ‡§∑‡§æ ‡§¨‡§ü‡§®‡§π‡§∞‡•Ç (EN/NE/NL) ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</li>
                        <li>‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø‡§π‡§∞‡•Ç ‡§§‡•Ä‡§®‡§µ‡§ü‡•à ‡§≠‡§æ‡§∑‡§æ‡§π‡§∞‡•Ç‡§Æ‡§æ ‡§¨‡•ã‡§≤‡§ø‡§®‡•ç‡§õ‡§®‡•ç</li>
                        <li>‡§Ü‡§µ‡§æ‡§ú ‡§Æ‡•ç‡§Ø‡•Å‡§ü/‡§Ö‡§®‡§Æ‡•ç‡§Ø‡•Å‡§ü ‡§ó‡§∞‡•ç‡§® ‡§≠‡•ã‡§≤‡•ç‡§Ø‡•Å‡§Æ ‡§¨‡§ü‡§® ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</li>
                    </ul>
                    <h3>‡§ñ‡•á‡§≤ ‡§®‡§ø‡§Ø‡§Æ‡§π‡§∞‡•Ç:</h3>
                    <ul>
                        <li>‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§ñ‡•á‡§≤‡§æ‡§°‡•Ä‡§≤‡•á ‡§™‡§æ‡§≤‡•à‡§™‡§æ‡§≤‡•ã ‡§™‡§æ‡§∏‡§æ ‡§ò‡•Å‡§Æ‡§æ‡§â‡§Å‡§õ‡§®‡•ç</li>
                        <li>‡§ï‡§æ‡§∞‡•ç‡§ü‡•Å‡§® ‡§ö‡§∞‡§ø‡§§‡•ç‡§∞‡§≤‡•á ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§® ‡§ó‡§∞‡•á‡§ï‡•ã ‡§π‡•á‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</li>
                        <li>‡§ß‡•á‡§∞‡•à ‡§≠‡§æ‡§∑‡§æ‡§π‡§∞‡•Ç‡§Æ‡§æ ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§∏‡•Å‡§®‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</li>
                        <li>‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®‡§Æ‡§æ ‡§¶‡•á‡§ñ‡§æ‡§á‡§è‡§ï‡•ã ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§™‡•Ç‡§∞‡§æ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</li>
                        <li>‡§∏‡§ï‡§ø‡§è‡§™‡§õ‡§ø "‡§Ö‡§∞‡•ç‡§ï‡•ã ‡§ñ‡•á‡§≤‡§æ‡§°‡•Ä" ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</li>
                        <li>‡§ñ‡•á‡§≤ ‡•ß‡•® ‡§∞‡§æ‡§â‡§®‡•ç‡§°‡§∏‡§Æ‡•ç‡§Æ ‡§ö‡§≤‡•ç‡§õ</li>
                    </ul>
                `,
                nl: `
                    <h3>Spel Instellen:</h3>
                    <ul>
                        <li>Kies het aantal spelers (1-4)</li>
                        <li>Selecteer een leeftijdsgroep (Kinderen 3-9 of Volwassenen)</li>
                        <li>Klik op "Start Spel" om te beginnen</li>
                    </ul>
                    <h3>Hoe Gooi Je de Dobbelstenen:</h3>
                    <ul>
                        <li>Druk en houd de SPATIEBALK op je toetsenbord in</li>
                        <li>Hoe langer je vasthoudt, hoe meer de balk vult</li>
                        <li>Laat los om te gooien!</li>
                    </ul>
                    <h3>Taal & Audio:</h3>
                    <ul>
                        <li>Gebruik taalknoppen (EN/NE/NL) om de interfacetaal te wijzigen</li>
                        <li>Activiteiten worden in alle drie talen gesproken</li>
                        <li>Gebruik de volumeknop om geluid te dempen/ontstemmen</li>
                    </ul>
                    <h3>Spelregels:</h3>
                    <ul>
                        <li>Elke speler gooit om de beurt de dobbelstenen</li>
                        <li>Kijk hoe het stripfiguur de activiteit demonstreert</li>
                        <li>Luister naar de activiteit in meerdere talen</li>
                        <li>Voltooi de activiteit die op het scherm wordt getoond</li>
                        <li>Klik op "Volgende Speler" als je klaar bent</li>
                        <li>Het spel duurt 12 rondes</li>
                    </ul>
                `
            };

            document.getElementById('helpContent').innerHTML = helpContent[currentLanguage];
            document.getElementById('helpModal').classList.add('active');
        }

        function closeHelp() {
            playSound('click');
            document.getElementById('helpModal').classList.remove('active');
        }

        document.getElementById('helpModal').addEventListener('click', (e) => {
            if (e.target.id === 'helpModal') {
                closeHelp();
            }
        });

        // Add click sounds to all buttons
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('btn') || e.target.closest('.btn')) {
                playSound('click');
            }
        });
    </script>
    <script src="game-features.js"></script>
</body>

</html>
